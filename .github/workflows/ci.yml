name: CI - Validation PHP

on:
  push:
    branches: [main, feat/**]
  pull_request:
    branches: [main]

jobs:
  phpcs:
    name: PHP CodeSniffer PSR12
    runs-on: ubuntu-latest
    strategy:
      matrix:
        php-version: ['8.2', '8.3', '8.4']
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Setup PHP ${{ matrix.php-version }}
      uses: shivammathur/setup-php@v2
      with:
        php-version: ${{ matrix.php-version }}
        tools: phpcs

    - name: Debug environment
      run: |
        echo "PHP version: $(php --version | head -1)"
        echo "PHPCS version: $(phpcs --version)"
        echo "Current dir: $(pwd)"
        ls -la plugins/generic/santaneAnalysisPlugin/

    - name: Run PHPCS with error handling
      run: |
        # Exécute phpcs mais ne fait pas échouer le job immédiatement
        phpcs --standard=PSR12 --extensions=php plugins/generic/santaneAnalysisPlugin/ || true
        
    - name: Run PHPCS properly
      run: |
        # Cette étape va échouer normalement si il y a des erreurs
        phpcs --standard=PSR12 --extensions=php --report=full plugins/generic/santaneAnalysisPlugin/

  security-scan:
    name: Analyse de Sécurité
    runs-on: ubuntu-latest
    needs: phpcs
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Basic security check
      run: echo "Analyse de sécurité simulée"