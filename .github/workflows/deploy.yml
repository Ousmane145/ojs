name: Deploy Premium Plugin

on:
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ”‘ Setup SSH
        uses: webfactory/ssh-agent@v0.8.0
        with:
          ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}

      - name: ðŸš€ Deploy via Tar Archive
        env:
          SERVER_USER: ${{ secrets.SERVER_USER }}
          SERVER_HOST: ${{ secrets.SERVER_IP }}
        run: |
          echo "ðŸš€ Deploying to $SERVER_USER@$SERVER_HOST..."

          # CrÃ©ation de l'archive
          tar -czf premium-plugin.tar.gz -C plugins/generic/premiumSubmissionHelper/ .

          # Upload
          scp -o StrictHostKeyChecking=no \
            premium-plugin.tar.gz \
            $SERVER_USER@$SERVER_IP:/tmp/

          ssh -o StrictHostKeyChecking=no $SERVER_USER@$SERVER_IP "
            sudo rm -rf /var/www/html/ojs/plugins/generic/premiumSubmissionHelper/
            sudo mkdir -p /var/www/html/ojs/plugins/generic/premiumSubmissionHelper/
            sudo tar -xzf /tmp/premium-plugin.tar.gz -C /var/www/html/ojs/plugins/generic/premiumSubmissionHelper/
            sudo chown -R www-data:www-data /var/www/html/ojs/plugins/generic/premiumSubmissionHelper/
            sudo chmod -R 755 /var/www/html/ojs/plugins/generic/premiumSubmissionHelper/
            sudo rm /tmp/premium-plugin.tar.gz
            echo 'âœ… Plugin deployed successfully!'
          "