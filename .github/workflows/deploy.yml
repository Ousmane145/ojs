name: ðŸš€ Deploy Premium Plugin

on:
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: ðŸš€ Deploy via Tar
      run: |
        # CrÃ©ation de l'archive
        tar -czf premium-plugin.tar.gz -C plugins/generic/premiumSubmissionHelper/ .
        
        # Upload
        scp -o StrictHostKeyChecking=no \
          premium-plugin.tar.gz \
          ${{ secrets.SERVER_USER }}@${{ secrets.SERVER_IP }}:/tmp/
        
        # Extraction et permissions
        ssh -o StrictHostKeyChecking=no ${{ secrets.SERVER_USER }}@${{ secrets.SERVER_IP }} "
          sudo rm -rf /var/www/html/ojs/plugins/generic/premiumSubmissionHelper/
          sudo mkdir -p /var/www/html/ojs/plugins/generic/premiumSubmissionHelper/
          sudo tar -xzf /tmp/premium-plugin.tar.gz -C /var/www/html/ojs/plugins/generic/premiumSubmissionHelper/
          sudo chown -R www-data:www-data /var/www/html/ojs/plugins/generic/premiumSubmissionHelper/
          sudo find /var/www/html/ojs/plugins/generic/premiumSubmissionHelper/ -type f -exec chmod 644 {} \;
          sudo find /var/www/html/ojs/plugins/generic/premiumSubmissionHelper/ -type d -exec chmod 755 {} \;
          sudo rm /tmp/premium-plugin.tar.gz
          echo 'âœ… Plugin deployed with correct permissions!'
        "